# Cursor Rules - FAMO TrafficApp 3.0

**WICHTIG:** Diese Regeln werden automatisch von Cursor geladen. Lies sie in dieser Reihenfolge!

---

## üî¥ PFLICHT: Immer zuerst lesen (in dieser Reihenfolge!)

**‚ö†Ô∏è KRITISCH:** Vor JEDEM gr√∂√üeren Code-Umbau M√úSSEN diese Dateien gelesen werden:

1. **`Global/GLOBAL_STANDARDS.md`** - 7 Arbeitsregeln, Audit-Prozess, Safety
2. **`PROJECT_PROFILE.md`** - Stack, Infrastruktur, Module, Regeln
3. **`Regeln/STANDARDS.md`** - Vollst√§ndige Standards (bei Bedarf)
4. **`Regeln/STANDARDS_QUICK_REFERENCE.md`** - Schnellreferenz (kompakt)
5. **`Regeln/REGELN_AUDITS.md`** - 7 unverhandelbare Audit-Regeln
6. **`Regeln/AUDIT_CHECKLISTE.md`** - 9-Punkte-Checkliste
7. **`README_AUDIT_COMPLETE.md`** - Vollst√§ndige Audit-√úbersicht (konkreter Audit-Kontext)

**Dann erst:**
- **`Regeln/CURSOR_PROMPT_TEMPLATE.md`** - 12 fertige Templates
- **`Regeln/LESSONS_LOG.md`** - Lernhistorie (bekannte Fehler)
- **`Regeln/CURSOR_WORKFLOW.md`** - 6-Schritt-Workflow-Prozess
- **`Regeln/AUDIT_FLOW_ROUTING.md`** - Modularer Audit-Flow (Routing/OSRM)
- **`Regeln/ADMIN_NAVIGATION_STANDARDS.md`** - Admin-Bereich: Navigation & Layout-Standards (bei Admin-√Ñnderungen!)
- **`Global/CURSOR_USAGE_BEISPIEL.md`** - Copy & Paste Prompts (3 Szenarien)

---

## üìÅ VERZEICHNIS-REGELN: Was darf Cursor bearbeiten?

### ‚úÖ Prim√§r bearbeitbare Verzeichnisse

Cursor darf **prim√§r** in diesen Verzeichnissen Code √§ndern:

- **`backend/`** - Python Backend (FastAPI)
- **`backend/routes/`** - API-Endpoints
- **`backend/services/`** - Business-Logik
- **`backend/utils/`** - Hilfsfunktionen
- **`frontend/`** - Frontend (HTML, JS, CSS)
- **`frontend/js/`** - JavaScript-Module
- **`tests/`** - Test-Dateien (nur hinzuf√ºgen/erweitern, nicht l√∂schen ohne Absprache)

### üîí NUR LESEN, NICHT SCHREIBEN

Diese Verzeichnisse/Dateien sind **TABU** f√ºr Code-√Ñnderungen:

- **`docs/`** - Dokumentation (nur lesen, Updates nur auf explizite Anweisung)
- **`Global/`** - Globale Standards (nur lesen)
- **`Regeln/`** - Projekt-Standards (nur lesen, Updates nur auf explizite Anweisung)
- **`db/migrations/`** - Datenbank-Migrationen (nur lesen, neue nur mit Migration-Script)
- **`ZIP/`** - Audit-ZIPs (nur lesen)
- **`backups/`** - Backups (nur lesen)
- **`venv/`** - Virtual Environment (niemals √§ndern)
- **`.git/`** - Git-Konfiguration (niemals √§ndern)
- **`*.md`** im Root (README, CHANGELOG, etc.) - nur lesen, Updates nur auf explizite Anweisung

**Ausnahme:** `Regeln/LESSONS_LOG.md` darf bei neuen Fehlern aktualisiert werden (siehe Regel #6).

### ‚ö†Ô∏è Generierter Code / Auto-Gen-Files

- **Tabu:** Automatisch generierte Dateien (falls vorhanden)
- **Tabu:** Build-Artefakte, Cache-Dateien, Log-Dateien

---

## üéØ Schnellstart f√ºr h√§ufige Aufgaben

### Szenario 1: Bug fixen
1. **Lies:** `Regeln/CURSOR_WORKFLOW.md` ‚Üí 6-Schritt-Prozess
2. **Lies:** `PROJECT_PROFILE.md` (Projektkontext)
3. **Lies:** `Global/CURSOR_USAGE_BEISPIEL.md` ‚Üí Szenario 1 (Bug-Fix)
4. **Lies:** `Regeln/LESSONS_LOG.md` (bekannte Fehler)
5. **Dann:** Bug analysieren & fixen

### Szenario 2: Code-Review / Audit
1. **Lies:** `Regeln/CURSOR_WORKFLOW.md` ‚Üí 6-Schritt-Prozess
2. **Lies:** `Regeln/REGELN_AUDITS.md` (7 Regeln)
3. **Lies:** `Regeln/AUDIT_CHECKLISTE.md` (9 Punkte)
4. **Lies:** `PROJECT_PROFILE.md` (Projektkontext)
5. **Dann:** Review durchf√ºhren

### Szenario 3: Routing/OSRM Problem
1. **Lies:** `Regeln/CURSOR_WORKFLOW.md` ‚Üí 6-Schritt-Prozess
2. **Lies:** `Regeln/AUDIT_FLOW_ROUTING.md` (kompletter Flow)
3. **Lies:** `PROJECT_PROFILE.md` ‚Üí Abschnitt 3.2 (Touren-Workflow)
4. **Lies:** `Regeln/LESSONS_LOG.md` ‚Üí Eintrag #3 (Sub-Routen-Generator)
5. **Dann:** Routing analysieren

### Szenario 4: Sub-Routen-Generator Problem
1. **Lies:** `Regeln/CURSOR_WORKFLOW.md` ‚Üí 6-Schritt-Prozess
2. **Lies:** `Regeln/CURSOR_PROMPT_TEMPLATE.md` ‚Üí Template #11 (Sub-Routen)
3. **Lies:** `Regeln/LESSONS_LOG.md` ‚Üí Eintrag #3
4. **Lies:** `PROJECT_PROFILE.md` ‚Üí Abschnitt 3.2
5. **Dann:** Problem analysieren

### Szenario 5: Admin-Bereich erweitern / √§ndern
1. **Lies:** `Regeln/CURSOR_WORKFLOW.md` ‚Üí 6-Schritt-Prozess
2. **Lies:** `Regeln/ADMIN_NAVIGATION_STANDARDS.md` - **KRITISCH:** Navigation-Standards
3. **Lies:** `PROJECT_PROFILE.md` (Projektkontext)
4. **Dann:** Admin-√Ñnderung durchf√ºhren (nur Tabs in `admin.html`, keine separaten Seiten!)

---

## ‚ö†Ô∏è KRITISCHE REGELN (niemals ignorieren!)

### 1. Kein Ghost-Refactor
‚ùå Keine gro√üen Umbauten ohne explizite Freigabe
‚úÖ Nur gezielte √Ñnderungen im definierten Scope

### 2. Immer Backend + Frontend gemeinsam pr√ºfen
‚ùå Nicht nur Backend ODER Frontend
‚úÖ API-Kontrakt zwischen beiden Seiten validieren

### 3. Defensive Programmierung ist Pflicht
‚ùå Keine fehlenden Null-Checks, Type-Checks, Array-Checks
‚úÖ Alle Inputs validieren, alle Edge-Cases abfangen

### 4. Schema-√Ñnderungen immer mit Migration
‚ùå Keine DB-Schema-√Ñnderungen ohne Migration-Script
‚úÖ Immer `db/migrations/YYYY-MM-DD_beschreibung.sql` erstellen

### 5. Tests vorschlagen (min. 2 pro √Ñnderung)
‚ùå Keine Code-√Ñnderung ohne Test-Vorschlag
‚úÖ Backend-Test + Frontend-Test + (optional) Unit-Test
‚úÖ **Golden-Tests f√ºr kritische Pfade:** Sub-Routen-Generator, Tour-Upload, Geocoding, OSRM-Routing
‚úÖ Bei √Ñnderungen an kritischen Pfaden: Golden-Tests erg√§nzen/aktualisieren und ausf√ºhren

### 6. LESSONS_LOG aktualisieren bei neuen Fehlern
‚ùå Neue Fehlerpattern nicht dokumentiert lassen
‚úÖ Immer in `Regeln/LESSONS_LOG.md` eintragen
‚úÖ Wenn Fehlerklasse mehr als 1x vorkommt: `REGELN_AUDITS.md` oder `STANDARDS.md` anpassen

### 7. Sprache: Deutsch
‚úÖ Alle Antworten auf Deutsch (au√üer Code-Kommentare wenn n√∂tig)

### 8. Scope immer explizit machen
‚ùå Keine √Ñnderungen au√üerhalb des definierten Scopes
‚úÖ Nur die minimal n√∂tigen Files anfassen
‚úÖ Bei gr√∂√üeren √Ñnderungen: Audit-ZIP vorbereiten (siehe `Regeln/CURSOR_WORKFLOW.md`)

### 9. Cursor-Workflow befolgen
‚ùå Keine √Ñnderungen ohne vorherige Kontext-Ladung
‚úÖ **Immer** den 6-Schritt-Prozess aus `Regeln/CURSOR_WORKFLOW.md` befolgen:
   1. Problem klarziehen
   2. Audit-ZIP vorbereiten
   3. Template w√§hlen
   4. √Ñnderung einbauen
   5. Tests & Health-Checks
   6. Lessons aktualisieren

### 10. Admin-Bereich: Nur EINE Admin-Hauptseite
‚ùå Keine separaten Admin-HTML-Seiten (`admin_*.html`) erstellen
‚ùå Keine doppelte Navigation im Admin-Bereich
‚úÖ **Immer** `admin.html` mit Tabs erweitern (siehe `Regeln/ADMIN_NAVIGATION_STANDARDS.md`)
‚úÖ Neue Admin-Module als Tabs/Sektionen in bestehender Struktur integrieren

---

## üß™ Golden-Tests f√ºr kritische Pfade

**Ziel:** Wenn KI/Dev etwas an den Hot-Paths √§ndert, fliegen Fehler sofort auf.

### Kritische Pfade (m√ºssen getestet werden):

- **Sub-Routen-Generator** (Frontend + Backend-Endpoint)
- **Tour-Upload & Parsing**
- **Geocoding & Matching**
- **OSRM / `/api/tour/route-details`**

### Test-Struktur:

- **Ordner:** `tests/golden/` (wird bei Bedarf erstellt)
- **Unterordner:** `tests/golden/subroutes/`, `tests/golden/routing/`, `tests/golden/geocoding/`
- **Jeder Test:** Nutzt realistische Beispiel-Touren, erwartete Outputs sind fest gespeichert (JSON/Snapshots)

**Cursor-Anweisung:**
- Bei √Ñnderungen an Routing/Subrouten/Geocoding **immer** die passenden Golden-Tests erg√§nzen/aktualisieren und ausf√ºhren.

---

## üîß Git-Hooks & CI

### Pre-Commit Hook (lokal)

**Ziel:** Commit blocken bei Fehlern

**Pr√ºfungen:**
- Lint & Format (Python: `ruff` / `black`, JS: `eslint` falls konfiguriert)
- Schnelle Tests: `pytest -q` (oder zumindest `pytest tests/golden -q`)

**Status:** Wird bei Bedarf eingerichtet (aktuell optional)

### CI-Pipeline (GitHub Actions)

**Jobs:**
1. **lint** ‚Äì ruff/eslint
2. **test** ‚Äì alle Tests + Golden-Tests
3. Optional: **ki-audit** ‚Äì kleiner KI-Check nur lesend (kein Auto-Code-Change in CI)

**Merge in `main` nur, wenn alle Jobs gr√ºn.**

---

## üîó Verwandte Dateien

**F√ºr neue Projekte:**
‚Üí `Global/PROJEKT_TEMPLATE.md` - Template zum Kopieren

**F√ºr Versionierung:**
‚Üí `CHANGELOG.md` - Aktuelle Versionshistorie

**F√ºr Status:**
‚Üí `STATUS_AKTUELL.md` - Aktueller System-Status

**F√ºr √úbersicht:**
‚Üí `DOKUMENTATION.md` - Single Source of Truth (17 Dokumente)

---

## üìä Projekt-Info

**Projekt:** FAMO TrafficApp 3.0  
**Stack:** Python 3.10, FastAPI, Vanilla JS, SQLite  
**Infrastruktur:** Proxmox-LXC, Docker (OSRM), Leaflet  
**Hauptfeatures:** Touren-Workflow, Sub-Routen-Generator, OSRM-Routing

**Dokumentation:** 18 Dokumente (~6.800 Zeilen)  
**Stand:** 2025-11-19  
**Version:** 2.3 (Admin-Navigation-Standards hinzugef√ºgt)

---

**üåç Global ‚Üí Projekt ‚Üí Code**

Bei Unsicherheit: Lies zuerst `DOKUMENTATION.md` f√ºr vollst√§ndige √úbersicht!

